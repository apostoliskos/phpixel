---

import { Icon } from 'astro-icon/components';
import {
  Button,
  CtaCardSection,
} from '@components/odyssey-theme';
---

<style>
  .announcement-banner__container {
    padding: 0.5rem;
    display: flex;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    background-color: #fff;
    color: #fff;
    position: relative;
    z-index: 100;
    height: 100vh;

    background-image: url("/assets/images/pixelated_1080.webp");
    background-repeat: no-repeat;
    background-size: cover;
    background-position: center;
  }
  .announcement-banner__container p {
    text-align: center;
  }

  /* Ensure the container is the reference point */
  .announcement-banner__container {
    position: relative;
    overflow: hidden;
  }

  /* The shadow overlay */
  .shadow {
    position: absolute;
    top: 0;
    left: 0;
    width: 100%;
    height: 100%;
    background-color: #000;
    opacity: 0.6;
    z-index: 1;
  }

  .anouncement_main_content {
    position: relative;
    z-index: 2;
    width: 100%;
    text-align: center;
  }
  .fitpac {
    font-size: var(--font-size-xxl);
  }










  .scroll-indicator {
    width: 26px;
    height: 42px;
    border: 2px solid currentColor;
    border-radius: 20px;
    position: absolute;
    z-index: 2;
    bottom: 50px;
  }

  .scroll-indicator span {
    width: 4px;
    height: 8px;
    background: currentColor;
    border-radius: 2px;
    position: absolute;
    top: 8px;
    left: 50%;
    transform: translateX(-50%);
    animation: scrollDot 1.6s infinite;
  }

  @keyframes scrollDot {
    0% {
      opacity: 0;
      transform: translate(-50%, 0);
    }
    30% {
      opacity: 1;
    }
    60% {
      opacity: 1;
      transform: translate(-50%, 10px);
    }
    100% {
      opacity: 0;
      transform: translate(-50%, 14px);
    }
  }


</style>
<div class="announcement-banner__container">
  <div class="shadow"></div>
  <div class="anouncement_main_content">
    <h2 class="fitpac">From idea to pixel and code</h2>
    <CtaCardSection background="transparent">
      <p>Μην διστάσεις να επικοινωνήσεις μαζί μας για να γίνει η ιδέα σου πραγματικότητα.</p>
      <div class="two_buttons">
        <!-- Icon after text (default) -->
        <Button href="/contact" customIcon iconPosition="before">Επικοινωνία<Fragment slot="icon"><Icon name="ic:baseline-mail" /></Fragment></Button>

        <!-- Icon before text -->
        <Button href="tel:6977383488" customIcon iconPosition="before">6977383488<Fragment slot="icon"><Icon name="ic:baseline-phone" /></Fragment></Button>

      </div>


    </CtaCardSection>


  </div>
  <div class="scroll-indicator">
    <span></span>
  </div>
</div>
<script is:inline>
  let isSnapping = false;
  let touchStartY = 0;

  const FIXED_HEADER_SELECTOR = '.site-header'; // optional fixed header
  const MOBILE_EXTRA = 24; // small compensation for mobile bar

  const getSnapTarget = () => {
    const el = document.querySelector('.header--right');
    if (!el) return 0;

    const fixedHeader = document.querySelector(FIXED_HEADER_SELECTOR);
    const FIXED_HEADER_HEIGHT = fixedHeader ? fixedHeader.offsetHeight : 0;

    // Mobile viewport height
    const vh = window.visualViewport?.height || window.innerHeight;

    // Distance from top of page
    const elementTop = el.getBoundingClientRect().top + window.scrollY;

    // Calculate final scroll target
    let target = elementTop - FIXED_HEADER_HEIGHT;

    // If on mobile, add the visualViewport difference to fill the screen
    if (window.innerWidth < 768) {
      const delta = window.innerHeight - vh;
      target -= delta; // compensate for shrinking bar
      target -= MOBILE_EXTRA; // optional extra to make gap disappear
    }

    return Math.max(0, target);
  };

  const snapScroll = () => {
    const target = getSnapTarget();
    if (!target) return;

    document.body.style.overflow = 'hidden';
    let start = null;
    const duration = 700;

    const step = (timestamp) => {
      if (!start) start = timestamp;
      const progress = Math.min((timestamp - start) / duration, 1);
      const current = window.scrollY + (target - window.scrollY) * progress;
      window.scrollTo(0, current);

      if (progress < 1) requestAnimationFrame(step);
      else {
        document.body.style.overflow = '';
        isSnapping = false;
      }
    };

    requestAnimationFrame(step);
  };

  // Desktop: wheel scroll
  window.addEventListener('wheel', (e) => {
    if (window.scrollY !== 0) return;
    if (e.deltaY <= 0) return;
    if (isSnapping) return;

    isSnapping = true;
    e.preventDefault();
    snapScroll();
  }, { passive: false });

  // Mobile: touch
  window.addEventListener('touchstart', (e) => {
    touchStartY = e.touches[0].clientY;
  }, { passive: true });

  window.addEventListener('touchmove', (e) => {
    const deltaY = touchStartY - e.touches[0].clientY;
    if (window.scrollY !== 0) return;
    if (deltaY <= 0) return;
    if (isSnapping) return;

    isSnapping = true;
    e.preventDefault();
    snapScroll();
  }, { passive: false });
</script>



